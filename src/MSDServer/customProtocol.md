# CRUX 서버 TCP 소켓 통신 및 커스텀 프로토콜

## 1. 개요  

CRUX 서버에서는 **실시간 데이터 수집 및 처리**를 위해  
**TCP 소켓 통신을 활용하여 클라이언트와 서버 간의 고속 통신을 구현**하였습니다.  
또한, **커스텀 프로토콜을 정의하여 데이터를 구조화**하여 송수신할 수 있도록 설계하였습니다.  

---

## 2. TCP 소켓 통신 구조  

![프로토콜](TCP소켓 프로토콜.png)  

### 🔹 **TCP 소켓 통신의 역할**
- **Edge Clients** → 실시간 센서 및 장비 데이터 수집  
- **CRUX Server** → TCP 스트리밍 데이터를 수신 및 처리  
- **TimescaleDB** → 수집된 데이터를 저장하여 실시간 분석 수행  

TCP 소켓을 이용하여 **지연시간(Latency)을 최소화**하면서  
**고속 데이터 전송이 가능하도록 설계**하였습니다.  

---

## 3. 커스텀 프로토콜 설계  

### 🔹 **데이터 전송 프로토콜**
| 필드명 | 크기(Bytes) | 설명 |
|--------|------------|----------------|
| **FrameType** | 1 | 프레임 유형 (데이터, 인증 등) |
| **Length** | 2 | 전체 패킷 길이 |
| **Version** | 1 | 프로토콜 버전 |
| **Role** | 1 | 클라이언트 역할 (Edge, Admin 등) |
| **Reserved** | 1 | 예약 필드 (확장용) |
| **Payload (Data)** | 40 | 센서 데이터 (40 Bytes) |

- 데이터를 **일정한 패킷 구조로 전송**하여 **서버가 효율적으로 파싱 가능**
- **40바이트 크기의 페이로드**로 센서 데이터를 구성하여 **최적화된 데이터 처리 가능**

---

### 🔹 **JWT 인증 프로토콜**
| 필드명 | 크기(Bytes) | 설명 |
|--------|------------|----------------|
| **FrameType** | 1 | 프레임 유형 (인증 요청) |
| **Length** | 2 | 전체 패킷 길이 |
| **Version** | 1 | 프로토콜 버전 |
| **Role** | 1 | 클라이언트 역할 (Edge, Admin 등) |
| **Reserved** | 1 | 예약 필드 (확장용) |
| **Payload (JWT Token)** | 가변 길이 | JWT 보안 토큰 |

- **JWT 기반 인증을 적용하여 TCP 통신에서도 보안 강화**
- **서버는 클라이언트가 제공한 JWT 토큰을 검증한 후 데이터 요청을 허용**
- **비인가 클라이언트의 접근을 방지하여 데이터 무결성 확보**

---

## 4. TCP 커스텀 프로토콜의 기대 효과  

| 기존 방식 문제점 | 개선 사항 |
|------------------|--------------------------------|
| REST API 기반 데이터 수집 시 지연 발생 | **TCP 소켓을 이용한 고속 데이터 전송으로 해결** |
| 데이터 포맷이 일정하지 않아 파싱 비용 증가 | **커스텀 프로토콜을 적용하여 구조화된 데이터 처리 가능** |
| 클라이언트 인증이 부족하여 보안 취약 | **JWT 기반 인증 적용으로 보안 강화** |
| 대량의 실시간 데이터 저장 시 성능 저하 | **TimescaleDB와 연동하여 대량 데이터 처리 최적화** |

## 5. 결론  

✅ **TCP 소켓 기반으로 실시간 고속 데이터 전송 구현**  
✅ **커스텀 프로토콜 적용으로 패킷 구조화 및 데이터 처리 최적화**  
✅ **JWT 인증을 활용하여 TCP 통신의 보안 강화**  
✅ **TimescaleDB와 연계하여 대용량 실시간 데이터 저장 및 분석 가능**  

CRUX 서버의 TCP 커스텀 프로토콜은 **고성능 실시간 데이터 처리 및 보안성을 갖춘 네트워크 아키텍처**를 제공합니다. 🚀